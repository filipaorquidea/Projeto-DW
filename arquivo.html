<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ARQUIVO</title>
    <link rel="stylesheet" href="arqcss.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body>
    <iframe src="nav.html" frameborder="0" style="display: none;"></iframe>
    <!-- Navigation bar -->
    <div id="nav-placeholder">
    </div>

    <script>
        $(function () {
            $("#nav-placeholder").load("nav.html");
        });
    </script>
       <!-- End of Navigation bar -->


    <div class="grid">

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            async function fetchProjectsJSON() {
                const response = await fetch('https://api.cosmicjs.com/v3/buckets/deep-strange-web-production/objects?pretty=true&query=%7B%22type%22:%22images%22%7D&read_key=UaK6ewXkTXExUTsdEZU6sQiFdljWaO4azEp5fE9FfUX7T41VnH&depth=1&props=slug,title,metadata,id');
                const projects = await response.json();
                return projects.objects;
            }

            fetchProjectsJSON().then(projects => {
                console.log(projects); // fetched images

                const grid = document.querySelector('.grid');
                for (let i = 0; i < projects.length; i++) {
                    const objectIcon = projects[i].metadata && projects[i].metadata.imagem !== null ? projects[i].metadata.imagem.url : ''; // Assuming the URL of the image is in the 'icon' property of the metadata
                    const objectId = projects[i].id;
                    const title = projects[i].title;
                    console.log(i);
                    const link = `objeto.html?id=${objectId}`;

                    grid.insertAdjacentHTML('beforeend', `<div class="container" title = "${title}"> <a href="${link}"><img src="${objectIcon}" alt="Project Image"><p>${title}</a></div>`);
                }

                //SEARCH BAR - INCOMPLETO, NOT WORKING ATM
                const searchBar = document.forms['search'].querySelector('input');
                const nome = document.getElementsByClassName("container").title;
                console.log(nome);

                searchBar.addEventListener('keyup', function (e) {
                    const search = e.target.value.toLowerCase();

                    Array.from(nome).forEach(function (obj) {
                        const titulo = obj.firstElementChild.title;
                        if (obj.toLowerCase().indexOf(search) != -1) {
                            obj.style.display = 'block';
                        } else {
                            obj.style.display = 'none';
                        }
                    })

                })
            });

        });


    </script>

</body>

</html>